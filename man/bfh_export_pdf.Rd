% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/export_pdf.R
\name{bfh_export_pdf}
\alias{bfh_export_pdf}
\title{Export BFH QIC Chart to PDF via Typst}
\usage{
bfh_export_pdf(
  x,
  output,
  metadata = list(),
  template = "bfh-diagram",
  template_path = NULL,
  auto_analysis = FALSE,
  use_ai = NULL,
  analysis_min_chars = 300,
  analysis_max_chars = 375
)
}
\arguments{
\item{x}{A \code{bfh_qic_result} object from \code{bfh_qic()}}

\item{output}{Character string specifying the output PDF file path}

\item{metadata}{List with optional metadata fields:
\itemize{
\item \code{hospital}: Hospital name (default: "Bispebjerg og Frederiksberg Hospital")
\item \code{department}: Department/unit name (optional)
\item \code{analysis}: Analysis text with findings (optional)
\item \code{details}: Period info, averages (auto-generated if not provided).
Auto-generated format: "Periode: feb. 2019 – mar. 2022 • Gns. måned: 58938/97266 •
Seneste måned: 60756/88509 • Nuværende niveau: 64,5\\%"
\item \code{author}: Author name (optional)
\item \code{date}: Report date (default: Sys.Date())
\item \code{data_definition}: Data definition text (optional)
\item \code{target}: Target value for analysis context (numeric or character, optional)
\item \code{footer_content}: Additional content to display below the chart (optional).
Supports markdown formatting (bold, italic, line breaks).
}}

\item{template}{Character string specifying template name (default: "bfh-diagram")}

\item{template_path}{Optional path to a custom Typst template file. When provided,
this overrides the packaged template. The template must exist and be a valid
Typst file (.typ). Default is NULL (uses packaged BFH template).}

\item{auto_analysis}{Logical. If TRUE and \code{metadata$analysis} is not provided,
automatically generates analysis text using \code{bfh_generate_analysis()}.
Default is FALSE for backward compatibility.}

\item{use_ai}{Logical or NULL. Controls AI usage for auto-analysis:
\itemize{
\item \code{NULL} (default): Auto-detect BFHllm availability
\item \code{TRUE}: Use AI via BFHllm (with fallback to standard texts)
\item \code{FALSE}: Use standard texts only (no AI)
}
Only used when \code{auto_analysis = TRUE}.}

\item{analysis_min_chars}{Minimum characters for AI-generated analysis. Default 300.
Only used when \code{auto_analysis = TRUE}.}

\item{analysis_max_chars}{Maximum characters for AI-generated analysis. Default 375.
Only used when \code{auto_analysis = TRUE}.}
}
\value{
The input object \code{x} invisibly, enabling pipe chaining
}
\description{
Exports an SPC chart created by \code{bfh_qic()} to a PDF document using
Typst templates for hospital branding. Requires Quarto CLI for compilation.
}
\details{
\strong{Requirements:}
\itemize{
\item Quarto CLI (>= 1.4.0) must be installed
\item Install from: https://quarto.org
}

\strong{PDF Generation Process:}
\enumerate{
\item Extract chart title from plot (removed from image for template)
\item Export chart to temporary PNG (without title)
\item Extract SPC statistics (runs, crossings, outliers)
\item Generate Typst document (.typ) with template
\item Compile to PDF via Quarto CLI
\item Clean up temporary files
}

\strong{Title Handling:}
\itemize{
\item Chart title is extracted and passed to Typst template
\item Title appears in PDF header, NOT in chart image
\item This differs from PNG export where title is in the image
}

\strong{Plot Optimization for PDF:}
\itemize{
\item Plot margins are set to 0mm for optimal fit in Typst template
\item Blank axis titles (NULL or empty) are removed with element_blank()
\item User-defined axis titles are preserved
}

\strong{SPC Statistics:}
\itemize{
\item Automatically extracted from bfh_qic_result$summary
\item Displayed in SPC table on PDF
\item Includes: runs (serielængde), crossings (antal kryds), outliers
}

\strong{Auto-Generated Details:}
\itemize{
\item If \code{metadata$details} is not provided, details are auto-generated
\item Format: "Periode: start - slut . Gns. interval: values . Seneste interval: values . Nuvaerende niveau: cl"
\item p/u-charts show numerator/denominator (e.g., "58938/97266")
\item Other chart types show only values (e.g., "127")
\item Interval labels adapt to data frequency (month, week, day, etc.)
}
}
\examples{
\dontrun{
library(BFHcharts)

# Create sample data
data <- data.frame(
  month = seq(as.Date("2024-01-01"), by = "month", length.out = 24),
  infections = rpois(24, lambda = 15)
)

# Create and export chart to PDF in one pipeline
bfh_qic(
  data = data,
  x = month,
  y = infections,
  chart_type = "i",
  y_axis_unit = "count",
  chart_title = "Hospital-Acquired Infections"
) |>
  bfh_export_pdf(
    "infections_report.pdf",
    metadata = list(
      hospital = "BFH",
      department = "Kvalitetsafdeling",
      analysis = "Signifikant fald observeret efter intervention",
      data_definition = "Antal hospital-erhvervede infektioner per måned"
    )
  )

# Multiple exports from same chart
result <- bfh_qic(data, month, infections, chart_type = "i",
                  chart_title = "Infections")

# PNG for email/presentation
bfh_export_png(result, "infections.png")

# PDF for official report
bfh_export_pdf(result, "infections_report.pdf",
               metadata = list(department = "ICU"))
}
}
\seealso{
\itemize{
\item \code{\link[=bfh_qic]{bfh_qic()}} to create SPC charts
\item \code{\link[=bfh_export_png]{bfh_export_png()}} to export as PNG
\item \code{\link[=bfh_create_typst_document]{bfh_create_typst_document()}} for low-level Typst generation
}
}
